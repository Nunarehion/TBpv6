import"../chunks/Bzak7iHL.js";import"../chunks/69_IOA4Y.js";import{o as Me}from"../chunks/bhRhCqWC.js";import{R as Ne,p as Oe,b as f,f as P,t as x,a as o,d as Ge,s as n,e as l,r as s,n as m,O as ve,ab as k,aE as L,c as Z}from"../chunks/CnxLOvM0.js";import{e as i,s as ee}from"../chunks/BFpeZ14H.js";import{i as u,s as qe,a as R}from"../chunks/DulKp6NI.js";import{e as He}from"../chunks/DVubXfnJ.js";import{s as ae}from"../chunks/CNL2E_I9.js";import{s as de}from"../chunks/Bfc47y5P.js";import{i as Je}from"../chunks/C-D-gK8t.js";import{w as T}from"../chunks/5VKP8Fpw.js";function me(B,g){var d;var v=(d=B.$$events)==null?void 0:d[g.type],F=Ne(v)?v.slice():v==null?[]:[v];for(var I of F)I.call(this,g)}var Ke=f('<p class="error-message svelte-5lo0zj"> </p>'),Qe=f("<p>Загрузка изображений...</p>"),Ve=f('<p class="error-message svelte-5lo0zj"> </p>'),We=f("<p>Изображений пока нет. Загрузите первое!</p>"),Xe=f('<div class="image-item svelte-5lo0zj"><img class="svelte-5lo0zj"/> <div class="image-controls svelte-5lo0zj"><button class="copy-button svelte-5lo0zj">Копировать ссылку</button> <button class="delete-button svelte-5lo0zj"><svg class="icon svelte-5lo0zj"><use href="/sprite.svg#trash-bin"></use></svg></button></div></div>'),Ye=f('<div class="image-grid svelte-5lo0zj"></div>'),Ze=f('<div class="image-preview-overlay svelte-5lo0zj" role="button" tabindex="0" aria-label="Закрыть предпросмотр"><div class="image-preview-content svelte-5lo0zj" role="dialog" aria-modal="true" tabindex="0"><button class="close-preview-button svelte-5lo0zj" aria-label="Закрыть предпросмотр">&times;</button> <img alt="Предпросмотр изображения" class="svelte-5lo0zj"/></div></div>'),ea=f('<div class="image-management-container svelte-5lo0zj"><h2 class="svelte-5lo0zj">Управление изображениями</h2> <div class="upload-section svelte-5lo0zj"><h3 class="svelte-5lo0zj">Загрузить новое изображение</h3> <div class="file-input-group svelte-5lo0zj"><input type="file" id="imageUploadInput" accept="image/*" hidden/> <label for="imageUploadInput" class="file-label-with-button svelte-5lo0zj"><span class="custom-file-button svelte-5lo0zj">Выбрать файл</span> <span class="file-name-display svelte-5lo0zj"> </span></label></div> <button class="svelte-5lo0zj"><!></button> <!></div> <hr/> <div class="image-list-section svelte-5lo0zj"><div class="list-header svelte-5lo0zj"><h3 class="svelte-5lo0zj">Существующие изображения</h3> <button class="svelte-5lo0zj"><!></button></div> <!></div></div> <!>',1);function ma(B,g){Oe(g,!1);const[v,F]=qe(),I=()=>R(N,"$loadingImageUpload",v),d=()=>R(p,"$error",v),S=()=>R(M,"$loadingImages",v),E=()=>R(te,"$images",v),te=T([]),M=T(!1),N=T(!1),p=T(null);let _=null,$=ve("Файл не выбран"),D=ve(null);const ue="/uploads/",O="/api/images";Me(()=>{U()});async function U(){M.set(!0),p.set(null);try{const e=await fetch(O);if(!e.ok){const t=await e.json();throw new Error(t.message||"Не удалось загрузить список изображений.")}const a=await e.json();te.set(a.images)}catch(e){console.error("Ошибка при получении списка изображений:",e),p.set(e.message)}finally{M.set(!1)}}async function fe(){if(!_||_.length===0){alert("Пожалуйста, выберите файл для загрузки.");return}const e=_[0];N.set(!0),p.set(null);try{const a=new FormData;a.append("image",e);const t=await fetch(O,{method:"POST",body:a});if(!t.ok){const y=await t.json();throw new Error(y.message||"Не удалось загрузить изображение.")}const c=await t.json();return alert(`Изображение "${e.name}" успешно загружено!`),_=null,k($,"Файл не выбран"),U(),c}catch(a){console.error("Ошибка при загрузке изображения:",a),alert(`Ошибка загрузки: ${a.message}`),p.set(a.message)}finally{N.set(!1)}}async function pe(e){if(confirm(`Вы уверены, что хотите удалить изображение "${e}"?`)){p.set(null);try{const a=await fetch(`${O}/${e}`,{method:"DELETE"});if(!a.ok){const c=await a.json();throw new Error(c.message||"Не удалось удалить изображение.")}const t=await a.json();return alert(`Изображение "${e}" успешно удалено!`),U(),t}catch(a){console.error("Ошибка при удалении изображения:",a),alert(`Ошибка удаления: ${a.message}`),p.set(a.message)}}}function ge(){U()}function _e(e){e.target.onerror=null,e.target.src="https://placehold.co/200x150/cccccc/000000?text=Error",console.warn(`Не удалось загрузить изображение: ${e.target.alt}. Установлена заглушка.`)}async function be(e){try{await navigator.clipboard.writeText(e),alert("Ссылка скопирована!")}catch(a){console.error("Не удалось скопировать текст с помощью Clipboard API:",a);const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),alert("Ссылка скопирована (через запасной метод)!")}catch(c){console.error("Не удалось скопировать текст с помощью execCommand:",c),alert("Ошибка при копировании ссылки. Пожалуйста, скопируйте вручную.")}finally{document.body.removeChild(t)}}}function he(e){k(D,e)}function G(){k(D,null)}function je(e){const a=e.target.files;a.length>0?(_=a,k($,a[0].name)):(_=null,k($,"Файл не выбран"))}Je();var se=ea(),q=P(se),H=n(l(q),2),J=n(l(H),2),oe=l(J),le=n(oe,2),re=n(l(le),2),ye=l(re,!0);s(re),s(le),s(J);var j=n(J,2),we=l(j);{var ze=e=>{var a=L("Загрузка...");o(e,a)},xe=e=>{var a=L("Загрузить изображение");o(e,a)};u(we,e=>{I()?e(ze):e(xe,!1)})}s(j);var ke=n(j,2);{var Ie=e=>{var a=Ke(),t=l(a);s(a),x(()=>ee(t,`Ошибка: ${d()??""}`)),o(e,a)};u(ke,e=>{d()&&d().includes("загрузк")&&e(Ie)})}s(H);var ne=n(H,4),K=l(ne),C=n(l(K),2),Ee=l(C);{var $e=e=>{var a=L("Обновление...");o(e,a)},De=e=>{var a=L("Обновить список");o(e,a)};u(Ee,e=>{S()?e($e):e(De,!1)})}s(C),s(K);var Ue=n(K,2);{var Ce=e=>{var a=Qe();o(e,a)},Ae=e=>{var a=Z(),t=P(a);{var c=r=>{var b=Ve(),Q=l(b);s(b),x(()=>ee(Q,`Не удалось загрузить список изображений: ${d()??""}`)),o(r,b)},y=r=>{var b=Z(),Q=P(b);{var Re=h=>{var A=We();o(h,A)},Te=h=>{var A=Z(),Be=P(A);{var Fe=V=>{var W=Ye();He(W,5,E,X=>X.filename,(X,w)=>{var Y=Xe(),z=l(Y),ie=n(z,2),ce=l(ie),Se=n(ce,2);s(ie),s(Y),x(()=>{ae(z,"src",m(w).url),ae(z,"alt",m(w).filename)}),i("error",z,_e),i("click",z,()=>he(m(w).url)),i("click",ce,()=>be(`${ue}${m(w).filename}`)),i("click",Se,()=>pe(m(w).filename)),o(X,Y)}),s(W),o(V,W)};u(Be,V=>{E()&&V(Fe)},!0)}o(h,A)};u(Q,h=>{E()&&E().length===0?h(Re):h(Te,!1)},!0)}o(r,b)};u(t,r=>{d()&&!d().includes("загрузк")?r(c):r(y,!1)},!0)}o(e,a)};u(Ue,e=>{S()?e(Ce):e(Ae,!1)})}s(ne),s(q);var Pe=n(q,2);{var Le=e=>{var a=Ze(),t=l(a),c=l(t),y=n(c,2);s(t),s(a),x(()=>ae(y,"src",m(D))),i("click",c,G),i("click",t,de(function(r){me.call(this,g,r)})),i("keydown",t,de(function(r){me.call(this,g,r)})),i("click",a,G),i("keydown",a,r=>{(r.key==="Enter"||r.key===" ")&&G()}),o(e,a)};u(Pe,e=>{m(D)&&e(Le)})}x(()=>{ee(ye,m($)),j.disabled=I(),C.disabled=S()}),i("change",oe,je),i("click",j,fe),i("click",C,ge),o(B,se),Ge(),F()}export{ma as component};
