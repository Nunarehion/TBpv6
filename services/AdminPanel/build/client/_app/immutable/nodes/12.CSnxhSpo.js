import"../chunks/Bzak7iHL.js";import{o as A}from"../chunks/bhRhCqWC.js";import{p as G,j as I,n as a,ab as t,b as y,e as i,t as x,a as p,d as K,aC as d,s as m,r as c,aD as L,aE as E}from"../chunks/CnxLOvM0.js";import{e as Q,s as S}from"../chunks/BFpeZ14H.js";import{i as k,s as R,a as U}from"../chunks/DulKp6NI.js";import{e as V}from"../chunks/DVubXfnJ.js";import{s as W}from"../chunks/m49QtOYO.js";import{b as X}from"../chunks/COlTbjMT.js";import{w as Y}from"../chunks/5VKP8Fpw.js";var Z=y("<option> </option>"),ee=y("<p> </p>"),se=y('<main class="svelte-189to9f"><h1 class="svelte-189to9f">Панель управления рассылками</h1> <div class="broadcast-section svelte-189to9f"><h2 class="svelte-189to9f">Запустить новую рассылку</h2> <div class="form-group svelte-189to9f"><label for="message-select" class="svelte-189to9f">Выберите сообщение:</label> <select id="message-select" class="svelte-189to9f"><option>-- Выберите сообщение --</option><!></select></div> <button class="broadcast-button svelte-189to9f"><!></button> <!></div> <hr class="svelte-189to9f"/></main>');function fe(M,T){G(T,!0);const[D,B]=R(),C=()=>U(_,"$messages",D);let l=d(""),r=d(""),f=d(!1),n=d(null);const _=Y([]);async function N(){try{const e=await fetch("/api/message");if(!e.ok){const o=await e.json();throw new Error(o.error||`Failed to fetch messages: ${e.status}`)}const s=await e.json();_.set(s)}catch(e){console.error("Error loading messages:",e),t(n,e.message,!0),_.set([])}}A(()=>{N()}),I(()=>{a(f)?(t(r,"Рассылка запускается..."),t(n,null)):a(n)?t(r,`Ошибка: ${a(n)}`):t(r,"")});async function O(){if(!a(l)){alert("Пожалуйста, выберите сообщение для рассылки.");return}t(f,!0),t(n,null),t(r,"Отправка запроса на рассылку...");try{const e=await fetch("/api/broadcast",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_name:a(l)})});if(!e.ok){const o=await e.json();throw new Error(o.error||`HTTP error! Status: ${e.status}`)}const s=await e.json();t(r,s.message||`Рассылка сообщения "${a(l)}" успешно запущена!`,!0),t(l,"")}catch(e){console.error("Error sending broadcast:",e),t(n,e.message,!0),t(r,`Ошибка: ${e.message}`)}finally{t(f,!1)}}var g=se(),j=m(i(g),2),b=m(i(j),2),h=m(i(b),2),w=i(h);w.value=w.__value="";var P=m(w);V(P,1,C,e=>e._id,(e,s)=>{var o=Z(),$=i(o,!0);c(o);var u={};x(()=>{S($,a(s).name),u!==(u=a(s).name)&&(o.value=(o.__value=a(s).name)??"")}),p(e,o)}),c(h),c(b);var v=m(b,2),F=i(v);{var H=e=>{var s=E("Запуск рассылки...");p(e,s)},J=e=>{var s=E("Запустить рассылку");p(e,s)};k(F,e=>{a(f)?e(H):e(J,!1)})}c(v);var q=m(v,2);{var z=e=>{var s=ee();let o;var $=i(s,!0);c(s),x(u=>{o=W(s,1,"status-message svelte-189to9f",null,o,u),S($,a(r))},[()=>({"error-message":!!a(n)})]),p(e,s)};k(q,e=>{a(r)&&e(z)})}c(j),L(2),c(g),x(()=>v.disabled=!a(l)||a(f)),X(h,()=>a(l),e=>t(l,e)),Q("click",v,O),p(M,g),K(),B()}export{fe as component};
